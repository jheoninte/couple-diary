<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïö∞Î¶¨Ïùò Í≥µÍ∞Ñ - Ïª§Ìîå Îã§Ïù¥Ïñ¥Î¶¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B9D;
            --secondary: #C06C84;
            --accent: #F8B195;
            --soft-pink: #FFE5EC;
            --cream: #FFF8F0;
            --deep-purple: #6C5B7B;
            --text-dark: #2D3142;
            --text-light: #9A8F97;
            --success: #A8DADC;
            --heart-red: #E63946;
            
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        /* ÌÖåÎßà ÏÉâÏÉÅ ÌîÑÎ¶¨ÏÖã */
        [data-theme="pink"] {
            --primary: #FF6B9D;
            --secondary: #C06C84;
            --accent: #F8B195;
            --soft-pink: #FFE5EC;
            --cream: #FFF8F0;
        }

        [data-theme="lavender"] {
            --primary: #9B8ED7;
            --secondary: #7B68BB;
            --accent: #B8A6D9;
            --soft-pink: #E8E3F3;
            --cream: #F5F3F9;
        }

        [data-theme="mint"] {
            --primary: #6DCCB1;
            --secondary: #4DB396;
            --accent: #8FD9C4;
            --soft-pink: #E1F5EF;
            --cream: #F0FAF7;
        }

        [data-theme="peach"] {
            --primary: #FFB088;
            --secondary: #E89A72;
            --accent: #FFC9A8;
            --soft-pink: #FFF0E8;
            --cream: #FFF7F2;
        }

        [data-theme="coral"] {
            --primary: #FF9AAD;
            --secondary: #E67A8E;
            --accent: #FFB5C5;
            --soft-pink: #FFE8ED;
            --cream: #FFF5F7;
        }

        [data-theme="sky"] {
            --primary: #7EC8E3;
            --secondary: #5AADC7;
            --accent: #A3D8ED;
            --soft-pink: #E5F5FA;
            --cream: #F0F9FC;
        }

        [data-theme="rose"] {
            --primary: #E85D75;
            --secondary: #C94B61;
            --accent: #F08094;
            --soft-pink: #FDE7EB;
            --cream: #FFF2F4;
        }

        [data-theme="lilac"] {
            --primary: #C997D8;
            --secondary: #A87BBF;
            --accent: #D9B3E6;
            --soft-pink: #F3E9F7;
            --cream: #FAF5FC;
        }

        [data-theme="sage"] {
            --primary: #A8C5A8;
            --secondary: #8FAF8F;
            --accent: #C1D8C1;
            --soft-pink: #EEF5EE;
            --cream: #F7FAF7;
        }

        [data-theme="mauve"] {
            --primary: #B88BA7;
            --secondary: #9E7690;
            --accent: #CCA3BC;
            --soft-pink: #F2EBF0;
            --cream: #F9F5F8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, var(--soft-pink) 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        /* Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            10%, 30% { transform: scale(0.9); }
            20%, 40% { transform: scale(1.1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        /* Ìó§Îçî */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 28px 20px 24px;
            text-align: center;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 6px;
            letter-spacing: -0.5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        .header-subtitle {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 300;
        }

        .header-hearts {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .heart {
            animation: heartBeat 1.5s ease-in-out infinite;
            font-size: 14px;
        }

        .heart:nth-child(2) {
            animation-delay: 0.2s;
        }

        .heart:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Ïª®ÌÖåÏù¥ÎÑà */
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px 16px;
        }

        /* ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .tab-nav {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 24px;
            background: white;
            padding: 8px;
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
        }

        .tab-btn {
            padding: 14px 12px;
            border: none;
            background: transparent;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-light);
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .tab-btn.active {
            color: white;
            transform: scale(1.02);
        }

        .tab-btn.active::before {
            opacity: 1;
        }

        .tab-icon {
            display: block;
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* ÏÑπÏÖò */
        .section {
            display: none;
            animation: fadeInUp 0.4s ease;
        }

        .section.active {
            display: block;
        }

        /* Îã¨Î†• */
        .calendar-card {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav button {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--soft-pink);
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            color: var(--primary);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav button:active {
            transform: scale(0.95);
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 12px;
        }

        .weekday {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            padding: 8px 0;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            background: var(--cream);
            border: 2px solid transparent;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            padding: 4px 2px;
        }

        .day:hover {
            background: var(--soft-pink);
            transform: scale(1.08);
        }

        .day.other-month {
            color: #ddd;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .day.today {
            border-color: var(--primary);
            font-weight: 600;
        }

        .day.selected {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
            transform: scale(1.05);
        }

        .day.selected .day-number {
            color: white;
        }

        /* ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÏóêÏÑú Ïù¥Î™®ÏßÄÎäî ÏõêÎûò ÏÉâÏÉÅ Ïú†ÏßÄ */
        .day.selected .day-icons {
            /* ÌïÑÌÑ∞ Ï†úÍ±∞ - Ïù¥Î™®ÏßÄÎäî ÏÉâÏÉÅ Î≥ÄÍ≤Ω Î∂àÍ∞Ä */
        }

        /* Í∏∞ÎÖêÏùº ÏïÑÏù¥ÏΩòÏùÄ ÏõêÎûò ÏÉâÏÉÅ Ïú†ÏßÄ */
        .anniversary-icon {
            filter: none !important;
            -webkit-filter: none !important;
        }

        .day.selected .anniversary-icon {
            filter: none !important;
            -webkit-filter: none !important;
            opacity: 1 !important;
        }

        /* ÏùºÍ∏∞ ÏûëÏÑ± ÏïÑÏù¥ÏΩò ÌëúÏãú */
        .day-number {
            display: block;
            margin-bottom: 2px;
        }

        .day-icons {
            display: flex;
            gap: 2px;
            font-size: 12px;
            line-height: 1;
        }

        .day.has-entry .day-icons,
        .day.has-both .day-icons {
            display: flex;
        }

        /* Í≥µÌú¥Ïùº ÌëúÏãú Ï°∞Ï†ï */
        .day.holiday .day-number {
            color: var(--heart-red);
        }

        .day.holiday::before {
            content: attr(data-holiday);
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 7px;
            color: var(--heart-red);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 90%;
            font-weight: 500;
        }

        /* ÏùºÍ∏∞ ÏûëÏÑ± Ìèº */
        .diary-form {
            background: white;
            padding: 24px;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
        }

        .form-section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-icon {
            font-size: 18px;
        }

        /* ÎÇ†Ïßú ÏÑ†ÌÉù */
        .date-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--soft-pink);
            border-radius: 12px;
            font-family: inherit;
            font-size: 15px;
            transition: all 0.2s ease;
            background: var(--cream);
        }

        .date-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.1);
        }

        /* Í∏∞Î∂Ñ ÏÑ†ÌÉù */
        .mood-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .mood-btn {
            aspect-ratio: 1;
            border: 2px solid var(--soft-pink);
            background: white;
            border-radius: 16px;
            cursor: pointer;
            font-size: 28px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mood-btn:hover {
            transform: scale(1.1) rotate(10deg);
            border-color: var(--primary);
        }

        .mood-btn.selected {
            background: var(--soft-pink);
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: var(--shadow-sm);
        }

        /* ÏùºÍ∏∞ ÎÇ¥Ïö© */
        .diary-textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--soft-pink);
            border-radius: 16px;
            font-family: inherit;
            font-size: 15px;
            line-height: 1.6;
            resize: vertical;
            min-height: 160px;
            transition: all 0.2s ease;
            background: var(--cream);
        }

        .diary-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.1);
            background: white;
        }

        .diary-textarea::placeholder {
            color: var(--text-light);
        }

        .char-count {
            text-align: right;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 6px;
        }

        /* ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú */
        .photo-upload-area {
            border: 2px dashed var(--soft-pink);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            background: var(--cream);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload-area:hover {
            border-color: var(--primary);
            background: var(--soft-pink);
        }

        .photo-upload-area.drag-over {
            border-color: var(--primary);
            background: var(--soft-pink);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 40px;
            margin-bottom: 8px;
        }

        .upload-text {
            font-size: 14px;
            color: var(--text-light);
        }

        #photoInput {
            display: none;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 16px;
        }

        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-remove {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .preview-remove:hover {
            background: var(--heart-red);
            transform: scale(1.1);
        }

        /* Ï†ÄÏû• Î≤ÑÌäº */
        .save-btn {
            width: 100%;
            padding: 16px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            margin-top: 8px;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .save-btn:active {
            transform: translateY(0);
        }

        /* ÏùºÍ∏∞ Ïπ¥Îìú */
        .diary-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary);
            animation: fadeInUp 0.4s ease;
        }

        .diary-card.partner {
            border-left-color: var(--success);
        }

        .diary-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .diary-writer {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .diary-writer.partner-writer {
            color: var(--success);
        }

        .diary-date {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .diary-mood {
            font-size: 32px;
        }

        .diary-content {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-dark);
            margin-bottom: 16px;
            white-space: pre-wrap;
        }

        .diary-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: 16px;
        }

        .diary-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .diary-image:hover {
            transform: scale(1.05);
        }

        .diary-actions {
            display: flex;
            gap: 8px;
            border-top: 1px solid var(--soft-pink);
            padding-top: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--soft-pink);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-dark);
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: var(--soft-pink);
            border-color: var(--primary);
        }

        .action-btn.liked {
            background: var(--soft-pink);
            color: var(--heart-red);
            border-color: var(--heart-red);
        }

        /* ÎåìÍ∏Ä */
        .comments-section {
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid var(--soft-pink);
        }

        .comment {
            background: var(--cream);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            position: relative;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .comment-author {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
        }

        .comment-actions {
            display: flex;
            gap: 8px;
        }

        .comment-action-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 11px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .comment-action-btn:hover {
            background: var(--soft-pink);
            color: var(--primary);
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-dark);
        }

        .comment-edit-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--primary);
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            margin-top: 4px;
        }

        .comment-edit-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
        }

        .comment-edit-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .comment-edit-actions button {
            flex: 1;
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .comment-save-btn {
            background: var(--primary);
            color: white;
        }

        .comment-save-btn:hover {
            background: var(--secondary);
        }

        .comment-cancel-btn {
            background: var(--soft-pink);
            color: var(--text-dark);
        }

        .comment-cancel-btn:hover {
            background: var(--border-color);
        }

        /* Í≤ÄÏÉâ Í∏∞Îä• */
        .search-container {
            background: white;
            padding: 16px;
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 2px solid var(--soft-pink);
            border-radius: 12px;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-light);
        }

        .search-results {
            margin-top: 16px;
        }

        .search-result-item {
            background: var(--cream);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid var(--primary);
        }

        .search-result-item:hover {
            background: var(--soft-pink);
            transform: translateX(4px);
        }

        .search-result-date {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .search-result-preview {
            font-size: 14px;
            color: var(--text-dark);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Îπ†Î•∏ ÏûëÏÑ± Î≤ÑÌäº */
        .quick-write-btn {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 101;
            transition: all 0.3s ease;
            color: white;
        }

        .quick-write-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 24px rgba(255, 107, 157, 0.4);
        }

        .quick-write-btn:active {
            transform: scale(1.05) rotate(90deg);
        }

        /* ÏùºÍ∏∞ Í∏∏Ïù¥ ÌëúÏãú */
        .diary-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--soft-pink);
            font-size: 12px;
            color: var(--text-light);
        }

        .diary-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ÌôïÏù∏ ÌåùÏóÖ Î™®Îã¨ */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1002;
            align-items: center;
            justify-content: center;
            animation: fadeInUp 0.3s ease;
        }

        .confirm-modal.active {
            display: flex;
        }

        .confirm-content {
            background: white;
            border-radius: 20px;
            padding: 32px 24px;
            max-width: 360px;
            width: 85%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .confirm-icon {
            font-size: 56px;
            margin-bottom: 16px;
        }

        .confirm-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 12px;
        }

        .confirm-message {
            font-size: 15px;
            color: var(--text-light);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .confirm-actions {
            display: flex;
            gap: 12px;
        }

        .confirm-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .confirm-btn-cancel {
            background: var(--soft-pink);
            color: var(--text-dark);
        }

        .confirm-btn-cancel:hover {
            background: var(--border-color);
        }

        .confirm-btn-delete {
            background: var(--heart-red);
            color: white;
        }

        .confirm-btn-delete:hover {
            background: #d62839;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .comment-input-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .comment-input-group input {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid var(--soft-pink);
            border-radius: 12px;
            font-family: inherit;
            font-size: 14px;
        }

        .comment-input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .comment-input-group button {
            padding: 10px 20px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .comment-input-group button:hover {
            background: var(--secondary);
        }

        /* Ï∂îÏñµ Í∞§Îü¨Î¶¨ */
        .memories-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .memory-item {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .memory-item:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .memory-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-header {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            text-align: center;
        }

        .gallery-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .gallery-count {
            font-size: 14px;
            color: var(--text-light);
        }

        /* Îπà ÏÉÅÌÉú */
        .empty-state {
            background: white;
            padding: 60px 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            animation: float 3s ease-in-out infinite;
        }

        .empty-state p {
            font-size: 15px;
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .empty-state-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .empty-state-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .empty-state-btn:active {
            transform: translateY(0);
        }

        /* Ïù¥ÎØ∏ÏßÄ Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeInUp 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            transform: scale(1.1) rotate(90deg);
        }

        /* ÏûêÎèô Ï†ÄÏû• ÌëúÏãú */
        .autosave-indicator {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 999;
        }

        .autosave-indicator.show {
            opacity: 1;
        }

        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stats-card {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: var(--cream);
            border-radius: 12px;
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-light);
        }

        /* ÏÑ§Ï†ï Î™®Îã¨ */
        .settings-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 101;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }

        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            animation: fadeInUp 0.3s ease;
        }

        .settings-modal.active {
            display: flex;
        }

        .settings-content {
            background: white;
            border-radius: 24px;
            padding: 32px 24px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .settings-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .settings-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--soft-pink);
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .settings-close:hover {
            background: var(--primary);
            color: white;
            transform: rotate(90deg);
        }

        .settings-section {
            margin-bottom: 28px;
        }

        .settings-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }

        .icon-btn {
            aspect-ratio: 1;
            border: 3px solid var(--soft-pink);
            background: white;
            border-radius: 16px;
            cursor: pointer;
            font-size: 32px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .icon-btn:hover {
            transform: scale(1.1);
            border-color: var(--primary);
        }

        .icon-btn.selected {
            background: var(--soft-pink);
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: var(--shadow-sm);
        }

        .icon-btn.selected::after {
            content: '‚úì';
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 20px;
            height: 20px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-label {
            text-align: center;
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .save-settings-btn {
            width: 100%;
            padding: 14px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .save-settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ÌÖåÎßà ÏÉâÏÉÅ ÏÑ†ÌÉùÍ∏∞ */
        .theme-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 8px;
            background: white;
            border-radius: 12px;
        }

        .theme-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .theme-btn {
            width: 100%;
            height: 60px;
            border: 3px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: visible;
        }

        .theme-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .theme-btn.selected {
            border-color: var(--text-dark);
            box-shadow: 0 0 0 2px white, 0 0 0 5px var(--text-dark);
        }

        .theme-btn.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            color: white;
            font-weight: bold;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        /* ÌÖåÎßà Î≤ÑÌäº Î∞∞Í≤ΩÏÉâ - Ï†ÑÏ≤¥Î•º Ìï¥Îãπ ÏÉâÏÉÅÏúºÎ°ú */
        .theme-pink { background: linear-gradient(135deg, #FF6B9D, #C06C84); }
        .theme-lavender { background: linear-gradient(135deg, #9B8ED7, #7B68BB); }
        .theme-mint { background: linear-gradient(135deg, #6DCCB1, #4DB396); }
        .theme-peach { background: linear-gradient(135deg, #FFB088, #E89A72); }
        .theme-coral { background: linear-gradient(135deg, #FF9AAD, #E67A8E); }
        .theme-sky { background: linear-gradient(135deg, #7EC8E3, #5AADC7); }
        .theme-rose { background: linear-gradient(135deg, #E85D75, #C94B61); }
        .theme-lilac { background: linear-gradient(135deg, #C997D8, #A87BBF); }
        .theme-sage { background: linear-gradient(135deg, #A8C5A8, #8FAF8F); }
        .theme-mauve { background: linear-gradient(135deg, #B88BA7, #9E7690); }

        .theme-label {
            text-align: center;
            font-size: 12px;
            color: var(--text-dark);
            font-weight: 500;
        }

        /* Ï†úÎ™© ÏàòÏ†ï ÏûÖÎ†• */
        .title-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--soft-pink);
            border-radius: 12px;
            font-family: inherit;
            font-size: 15px;
            transition: all 0.2s ease;
            text-align: center;
        }

        .title-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 107, 157, 0.1);
        }

        /* Í∏∞ÎÖêÏùº Í¥ÄÎ¶¨ */
        .anniversary-list {
            margin-bottom: 16px;
        }

        .anniversary-item {
            background: var(--cream);
            padding: 14px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid var(--primary);
        }

        .anniversary-icon-display {
            font-size: 28px;
            margin-right: 12px;
        }

        .anniversary-info {
            flex: 1;
            display: flex;
            align-items: center;
        }

        .anniversary-text {
            flex: 1;
        }

        .anniversary-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .anniversary-date {
            font-size: 13px;
            color: var(--text-light);
        }

        .anniversary-dday {
            font-size: 12px;
            color: var(--primary);
            font-weight: 600;
            margin-top: 4px;
        }

        .anniversary-delete {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--soft-pink);
            color: var(--heart-red);
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .anniversary-delete:hover {
            background: var(--heart-red);
            color: white;
            transform: scale(1.1);
        }

        .add-anniversary-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 16px;
        }

        .add-anniversary-btn:hover {
            background: var(--soft-pink);
            border-style: solid;
        }

        .add-anniversary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .anniversary-form {
            background: var(--soft-pink);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .anniversary-icon-selector {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin-bottom: 12px;
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: white;
            border-radius: 10px;
        }

        .anniversary-icon-btn {
            aspect-ratio: 1;
            border: 2px solid var(--border-color);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .anniversary-icon-btn:hover {
            transform: scale(1.1);
            border-color: var(--primary);
        }

        .anniversary-icon-btn.selected {
            background: var(--soft-pink);
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: var(--shadow-sm);
        }

        .anniversary-selected-icon {
            font-size: 32px;
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .anniversary-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-family: inherit;
            font-size: 14px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .anniversary-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
        }

        .anniversary-form-actions {
            display: flex;
            gap: 8px;
        }

        .anniversary-save-btn,
        .anniversary-cancel-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .anniversary-save-btn {
            background: var(--primary);
            color: white;
        }

        .anniversary-save-btn:hover {
            background: var(--secondary);
        }

        .anniversary-cancel-btn {
            background: white;
            color: var(--text-dark);
        }

        .anniversary-cancel-btn:hover {
            background: var(--cream);
        }

        .anniversary-empty {
            text-align: center;
            padding: 24px;
            color: var(--text-light);
            font-size: 14px;
        }

        /* Îã¨Î†•Ïùò Í∏∞ÎÖêÏùº ÌëúÏãú */
        .day.anniversary-day {
            position: relative;
        }

        .day.anniversary-day .anniversary-icon {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 14px;
            line-height: 1;
            filter: none !important;
            -webkit-filter: none !important;
            z-index: 10;
        }

        .anniversary-badge {
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 8px;
        }

        /* Í∏∞ÎÖêÏùº ÏïåÎ¶º Ïπ¥Îìú */
        .anniversary-alert {
            background: linear-gradient(135deg, #FFE5EC, #FFF0F5);
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .anniversary-alert-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .anniversary-alert-content {
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Í≥µÌú¥Ïùº ÌëúÏãú */
        .day.holiday {
            font-weight: 600;
        }

        .holiday-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--soft-pink);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .holiday-indicator-icon {
            font-size: 18px;
        }

        .holiday-indicator-text {
            font-size: 13px;
            color: var(--heart-red);
            font-weight: 500;
        }

        /* ÏÇ¨Ïö©Ïûê ÏïÑÏù¥ÏΩò ÌëúÏãú */
        .user-icon {
            font-size: 20px;
        }

        .diary-writer-icon {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 380px) {
            .mood-selector {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .mood-btn {
                font-size: 24px;
            }

            .icon-selector {
                grid-template-columns: repeat(5, 1fr);
            }

            .icon-btn {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Ìó§Îçî -->
    <header class="app-header">
        <h1 class="header-title" id="appTitle">Ïö∞Î¶¨Ïùò Í≥µÍ∞Ñ</h1>
        <p class="header-subtitle">Îß§ÏùºÏùò ÏàúÍ∞ÑÏùÑ Ìï®Íªò Í∏∞Î°ùÌï¥Ïöî</p>
        <div class="header-hearts">
            <span class="heart">üíï</span>
            <span class="heart">üíñ</span>
            <span class="heart">üíï</span>
        </div>
    </header>

    <!-- ÏÑ§Ï†ï Î≤ÑÌäº -->
    <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>

    <!-- Îπ†Î•∏ ÏùºÍ∏∞ ÏûëÏÑ± Î≤ÑÌäº -->
    <button class="quick-write-btn" onclick="goToWrite()" title="ÏùºÍ∏∞ Ïì∞Í∏∞">‚úçÔ∏è</button>

    <!-- ÏÑ§Ï†ï Î™®Îã¨ -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h2 class="settings-title">ÏÑ§Ï†ï</h2>
                <button class="settings-close" onclick="closeSettings()">√ó</button>
            </div>

            <!-- ÎÇ¥ ÏïÑÏù¥ÏΩò ÏÑ†ÌÉù -->
            <div class="settings-section">
                <div class="settings-section-title">
                    <span>üë§</span> ÎÇ¥ ÏïÑÏù¥ÏΩò
                </div>
                <div class="icon-label">ÎèôÎ¨ºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                <div class="icon-selector">
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üê∂')">üê∂</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üê±')">üê±</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üê∞')">üê∞</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üêª')">üêª</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'ü¶ä')">ü¶ä</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üêº')">üêº</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üê®')">üê®</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üêØ')">üêØ</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'ü¶Å')">ü¶Å</button>
                    <button class="icon-btn" onclick="selectMyIcon(this, 'üê∏')">üê∏</button>
                </div>
            </div>

            <!-- ÌååÌä∏ÎÑà ÏïÑÏù¥ÏΩò ÏÑ†ÌÉù -->
            <div class="settings-section">
                <div class="settings-section-title">
                    <span>üíï</span> ÌååÌä∏ÎÑà ÏïÑÏù¥ÏΩò
                </div>
                <div class="icon-label">ÌååÌä∏ÎÑàÏùò ÎèôÎ¨ºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                <div class="icon-selector">
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üê∂')">üê∂</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üê±')">üê±</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üê∞')">üê∞</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üêª')">üêª</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'ü¶ä')">ü¶ä</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üêº')">üêº</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üê®')">üê®</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üêØ')">üêØ</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'ü¶Å')">ü¶Å</button>
                    <button class="icon-btn" onclick="selectPartnerIcon(this, 'üê∏')">üê∏</button>
                </div>
            </div>

            <!-- ÌÖåÎßà ÏÉâÏÉÅ ÏÑ†ÌÉù -->
            <div class="settings-section">
                <div class="settings-section-title">
                    <span>üé®</span> ÌÖåÎßà ÏÉâÏÉÅ
                </div>
                <div class="icon-label">ÏõêÌïòÎäî ÏÉâÏÉÅÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                <div class="theme-selector">
                    <div class="theme-item">
                        <button class="theme-btn theme-pink" onclick="selectTheme(this, 'pink')"></button>
                        <div class="theme-label">ÌïëÌÅ¨</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-lavender" onclick="selectTheme(this, 'lavender')"></button>
                        <div class="theme-label">ÎùºÎ≤§Îçî</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-mint" onclick="selectTheme(this, 'mint')"></button>
                        <div class="theme-label">ÎØºÌä∏</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-peach" onclick="selectTheme(this, 'peach')"></button>
                        <div class="theme-label">ÌîºÏπò</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-coral" onclick="selectTheme(this, 'coral')"></button>
                        <div class="theme-label">ÏΩîÎûÑ</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-sky" onclick="selectTheme(this, 'sky')"></button>
                        <div class="theme-label">Ïä§Ïπ¥Ïù¥</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-rose" onclick="selectTheme(this, 'rose')"></button>
                        <div class="theme-label">Î°úÏ¶à</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-lilac" onclick="selectTheme(this, 'lilac')"></button>
                        <div class="theme-label">ÎùºÏùºÎùΩ</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-sage" onclick="selectTheme(this, 'sage')"></button>
                        <div class="theme-label">ÏÑ∏Ïù¥ÏßÄ</div>
                    </div>
                    <div class="theme-item">
                        <button class="theme-btn theme-mauve" onclick="selectTheme(this, 'mauve')"></button>
                        <div class="theme-label">Î™®Î∏å</div>
                    </div>
                </div>
            </div>

            <!-- Ïï± Ï†úÎ™© Î≥ÄÍ≤Ω -->
            <div class="settings-section">
                <div class="settings-section-title">
                    <span>‚úèÔ∏è</span> Ïï± Ï†úÎ™©
                </div>
                <div class="icon-label">ÏÉÅÎã®Ïóê ÌëúÏãúÎê† Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏµúÎåÄ 20Ïûê)</div>
                <input type="text" class="title-input" id="appTitleInput" placeholder="Ïö∞Î¶¨Ïùò Í≥µÍ∞Ñ" maxlength="20">
            </div>

            <!-- Í∏∞ÎÖêÏùº Í¥ÄÎ¶¨ -->
            <div class="settings-section">
                <div class="settings-section-title">
                    <span>üéâ</span> Ïö∞Î¶¨Ïùò Í∏∞ÎÖêÏùº
                </div>
                <div class="icon-label">ÌäπÎ≥ÑÌïú ÎÇ†ÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî (ÏµúÎåÄ 5Í∞ú)</div>
                
                <div id="anniversaryList" class="anniversary-list"></div>
                
                <button class="add-anniversary-btn" onclick="showAddAnniversaryForm()" id="addAnniversaryBtn">
                    ‚ûï Í∏∞ÎÖêÏùº Ï∂îÍ∞ÄÌïòÍ∏∞
                </button>
                
                <div class="anniversary-form" id="anniversaryForm" style="display: none;">
                    <div class="anniversary-selected-icon" id="selectedAnniversaryIcon">üéâ</div>
                    <div class="anniversary-icon-selector">
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíë')">üíë</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíï')">üíï</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíñ')">üíñ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíù')">üíù</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíó')">üíó</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíì')">üíì</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíû')">üíû</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíò')">üíò</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéÇ')">üéÇ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéâ')">üéâ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéä')">üéä</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéà')">üéà</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéÅ')">üéÅ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéÄ')">üéÄ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üåπ')">üåπ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üå∫')">üå∫</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üå∑')">üå∑</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üå∏')">üå∏</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíê')">üíê</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üç∞')">üç∞</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üßÅ')">üßÅ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üç´')">üç´</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üç¨')">üç¨</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üç≠')">üç≠</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, '‚õ™')">‚õ™</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üíí')">üíí</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üè†')">üè†</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéÑ')">üéÑ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéÉ')">üéÉ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, 'üéÖ')">üéÖ</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, '‚≠ê')">‚≠ê</button>
                        <button type="button" class="anniversary-icon-btn" onclick="selectAnniversaryIcon(this, '‚ú®')">‚ú®</button>
                    </div>
                    <input type="text" class="anniversary-input" id="anniversaryName" placeholder="Í∏∞ÎÖêÏùº Ïù¥Î¶Ñ (Ïòà: Ïö∞Î¶¨Ïùò Ï≤´ ÎßåÎÇ®)" maxlength="20">
                    <input type="date" class="anniversary-input" id="anniversaryDate">
                    <div class="anniversary-form-actions">
                        <button class="anniversary-save-btn" onclick="saveAnniversary()">Ï†ÄÏû•</button>
                        <button class="anniversary-cancel-btn" onclick="cancelAnniversaryForm()">Ï∑®ÏÜå</button>
                    </div>
                </div>
            </div>

            <button class="save-settings-btn" onclick="saveSettings()">Ï†ÄÏû•ÌïòÍ∏∞</button>
        </div>
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
    <div class="container">
        <!-- ÌÉ≠ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('calendar', this)">
                <span class="tab-icon">üìÖ</span>
                Îã¨Î†•
            </button>
            <button class="tab-btn" onclick="switchTab('write', this)">
                <span class="tab-icon">‚úçÔ∏è</span>
                ÏûëÏÑ±
            </button>
            <button class="tab-btn" onclick="switchTab('memories', this)">
                <span class="tab-icon">üì∏</span>
                Ï∂îÏñµ
            </button>
        </nav>

        <!-- Îã¨Î†• ÏÑπÏÖò -->
        <section id="calendar" class="section active">
            <!-- Îã§Í∞ÄÏò§Îäî Í∏∞ÎÖêÏùº ÏïåÎ¶º -->
            <div id="upcomingAnniversary"></div>

            <!-- Í≤ÄÏÉâ Í∏∞Îä• -->
            <div class="search-container">
                <div class="search-box">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput"
                        placeholder="ÏùºÍ∏∞ ÎÇ¥Ïö© Í≤ÄÏÉâ..."
                        oninput="searchDiaries()"
                    >
                    <span class="search-icon">üîç</span>
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>

            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="stats-card">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalDays">0</div>
                        <div class="stat-label">Ìï®ÍªòÌïú ÎÇ†</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalEntries">0</div>
                        <div class="stat-label">Ï¥ù ÏùºÍ∏∞ Ïàò</div>
                    </div>
                </div>
            </div>

            <!-- Îã¨Î†• -->
            <div class="calendar-card">
                <div class="calendar-header">
                    <h3 class="calendar-month" id="currentMonth"></h3>
                    <div class="calendar-nav">
                        <button onclick="prevMonth()">‚óÄ</button>
                        <button onclick="nextMonth()">‚ñ∂</button>
                    </div>
                </div>
                <div class="weekdays">
                    <div class="weekday">Ïùº</div>
                    <div class="weekday">Ïõî</div>
                    <div class="weekday">Ìôî</div>
                    <div class="weekday">Ïàò</div>
                    <div class="weekday">Î™©</div>
                    <div class="weekday">Í∏à</div>
                    <div class="weekday">ÌÜ†</div>
                </div>
                <div class="days" id="calendarDays"></div>
            </div>

            <!-- ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÏùò ÏùºÍ∏∞ -->
            <div id="selectedDayEntries"></div>
        </section>

        <!-- ÏùºÍ∏∞ ÏûëÏÑ± ÏÑπÏÖò -->
        <section id="write" class="section">
            <div class="diary-form">
                <!-- ÎÇ†Ïßú ÏÑ†ÌÉù -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üìÜ</span>
                        ÎÇ†Ïßú
                    </div>
                    <input type="date" id="entryDate" class="date-input">
                </div>

                <!-- Í∏∞Î∂Ñ ÏÑ†ÌÉù -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üòä</span>
                        Ïò§ÎäòÏùò Í∏∞Î∂Ñ
                    </div>
                    <div class="mood-selector">
                        <button class="mood-btn" onclick="selectMood(this, 'üòä')">üòä</button>
                        <button class="mood-btn" onclick="selectMood(this, 'üòç')">üòç</button>
                        <button class="mood-btn" onclick="selectMood(this, 'ü•∞')">ü•∞</button>
                        <button class="mood-btn" onclick="selectMood(this, 'üò¢')">üò¢</button>
                        <button class="mood-btn" onclick="selectMood(this, 'üò§')">üò§</button>
                        <button class="mood-btn" onclick="selectMood(this, 'ü§ó')">ü§ó</button>
                        <button class="mood-btn" onclick="selectMood(this, 'ü§î')">ü§î</button>
                        <button class="mood-btn" onclick="selectMood(this, 'üò¥')">üò¥</button>
                        <button class="mood-btn" onclick="selectMood(this, 'üéâ')">üéâ</button>
                        <button class="mood-btn" onclick="selectMood(this, 'üí™')">üí™</button>
                    </div>
                </div>

                <!-- ÏùºÍ∏∞ ÎÇ¥Ïö© -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üìù</span>
                        Ïò§ÎäòÏùò ÏùºÍ∏∞
                    </div>
                    <textarea 
                        id="diaryContent" 
                        class="diary-textarea" 
                        placeholder="Ïò§Îäò ÌïòÎ£®Îäî Ïñ¥Îï†ÎÇòÏöî?&#10;ÌäπÎ≥ÑÌñàÎçò ÏàúÍ∞ÑÏùÑ Í∏∞Î°ùÌï¥Î≥¥ÏÑ∏Ïöî..."
                        maxlength="1000"
                        oninput="updateCharCount()"
                    ></textarea>
                    <div class="char-count">
                        <span id="charCount">0</span> / 1000
                    </div>
                </div>

                <!-- ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üì∑</span>
                        ÏÇ¨ÏßÑ (ÏµúÎåÄ 3Ïû•)
                    </div>
                    <div class="photo-upload-area" onclick="document.getElementById('photoInput').click()">
                        <div class="upload-icon">üì∏</div>
                        <div class="upload-text">ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</div>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" multiple>
                    <div class="photo-preview" id="photoPreview"></div>
                </div>

                <!-- Ï†ÄÏû• Î≤ÑÌäº -->
                <button class="save-btn" onclick="saveDiary()">
                    üíï Ï†ÄÏû•ÌïòÍ∏∞
                </button>
            </div>
        </section>

        <!-- Ï∂îÏñµ Í∞§Îü¨Î¶¨ ÏÑπÏÖò -->
        <section id="memories" class="section">
            <div class="gallery-header">
                <h2 class="gallery-title">Ïö∞Î¶¨Ïùò Ï∂îÏñµ üì∏</h2>
                <p class="gallery-count" id="galleryCount">0Í∞úÏùò ÏÇ¨ÏßÑ</p>
            </div>
            <div class="memories-grid" id="memoriesGrid">
                <div class="empty-state">
                    <div class="empty-state-icon">üéûÔ∏è</div>
                    <p>ÏïÑÏßÅ ÏÇ¨ÏßÑÏù¥ ÏóÜÏäµÎãàÎã§.<br>ÏùºÍ∏∞Ïóê ÏÇ¨ÏßÑÏùÑ Ï≤®Î∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Ïù¥ÎØ∏ÏßÄ Î™®Îã¨ -->
    <div class="modal" id="imageModal" onclick="closeModal()">
        <button class="modal-close">√ó</button>
        <img class="modal-content" id="modalImage">
    </div>

    <!-- ÏûêÎèô Ï†ÄÏû• ÌëúÏãú -->
    <div class="autosave-indicator" id="autosaveIndicator">
        ‚úì ÏûêÎèô Ï†ÄÏû•Îê®
    </div>

    <!-- ÌôïÏù∏ ÌåùÏóÖ Î™®Îã¨ -->
    <div class="confirm-modal" id="confirmModal" onclick="closeConfirmModalOnOutside(event)">
        <div class="confirm-content" onclick="event.stopPropagation()">
            <div class="confirm-icon" id="confirmIcon">‚ö†Ô∏è</div>
            <h3 class="confirm-title" id="confirmTitle">Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</h3>
            <p class="confirm-message" id="confirmMessage">Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.</p>
            <div class="confirm-actions">
                <button class="confirm-btn confirm-btn-cancel" onclick="closeConfirmModal()">Ï∑®ÏÜå</button>
                <button class="confirm-btn confirm-btn-delete" id="confirmDeleteBtn">ÏÇ≠Ï†ú</button>
            </div>
        </div>
    </div>
    <script type="module" src="firebase-sync.js"></script>
    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentDate = new Date();
        let selectedDate = new Date().toISOString().split('T')[0]; // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÎÇ†Ïßú
        let entries = JSON.parse(localStorage.getItem('diaryEntries')) || {};
        let partnerEntries = JSON.parse(localStorage.getItem('partnerEntries')) || {};
        let uploadedPhotos = [];
        let selectedMoodValue = '';
        let autosaveTimer = null;
        let startDate = localStorage.getItem('coupleStartDate') || new Date().toISOString().split('T')[0];
        let myIcon = localStorage.getItem('myIcon') || 'üê∂';
        let partnerIcon = localStorage.getItem('partnerIcon') || 'üê±';
        let confirmCallback = null; // ÌôïÏù∏ Î™®Îã¨ ÏΩúÎ∞±
        let anniversaries = JSON.parse(localStorage.getItem('anniversaries')) || [];
        let selectedAnniversaryIcon = 'üéâ'; // Í∏∞ÎÖêÏùº ÏïÑÏù¥ÏΩò
        let currentTheme = localStorage.getItem('appTheme') || 'pink';
        let appTitle = localStorage.getItem('appTitle') || 'Ïö∞Î¶¨Ïùò Í≥µÍ∞Ñ';

        // ÌôïÏù∏ Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò
        function showConfirmModal(title, message, callback, icon = '‚ö†Ô∏è') {
            document.getElementById('confirmIcon').textContent = icon;
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('active');
            
            confirmCallback = callback;
            
            // ÏÇ≠Ï†ú Î≤ÑÌäºÏóê Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            const deleteBtn = document.getElementById('confirmDeleteBtn');
            const newDeleteBtn = deleteBtn.cloneNode(true);
            deleteBtn.parentNode.replaceChild(newDeleteBtn, deleteBtn);
            
            newDeleteBtn.addEventListener('click', () => {
                if (confirmCallback) {
                    confirmCallback();
                }
                closeConfirmModal();
            });
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
            confirmCallback = null;
        }

        function closeConfirmModalOnOutside(event) {
            if (event.target.id === 'confirmModal') {
                closeConfirmModal();
            }
        }

        // 2025-2026 ÌïúÍµ≠ Í≥µÌú¥Ïùº
        const holidays = {
            '2025-01-01': 'Ïã†Ï†ï',
            '2025-01-28': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2025-01-29': 'ÏÑ§ÎÇ†',
            '2025-01-30': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2025-03-01': 'ÏÇºÏùºÏ†à',
            '2025-03-03': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2025-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2025-05-06': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2025-06-06': 'ÌòÑÏ∂©Ïùº',
            '2025-08-15': 'Í¥ëÎ≥µÏ†à',
            '2025-10-03': 'Í∞úÏ≤úÏ†à',
            '2025-10-05': 'Ï∂îÏÑùÏó∞Ìú¥',
            '2025-10-06': 'Ï∂îÏÑù',
            '2025-10-07': 'Ï∂îÏÑùÏó∞Ìú¥',
            '2025-10-08': 'ÎåÄÏ≤¥Í≥µÌú¥Ïùº',
            '2025-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2025-12-25': 'ÌÅ¨Î¶¨Ïä§ÎßàÏä§',
            '2026-01-01': 'Ïã†Ï†ï',
            '2026-02-16': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2026-02-17': 'ÏÑ§ÎÇ†',
            '2026-02-18': 'ÏÑ§ÎÇ†Ïó∞Ìú¥',
            '2026-03-01': 'ÏÇºÏùºÏ†à',
            '2026-05-05': 'Ïñ¥Î¶∞Ïù¥ÎÇ†',
            '2026-05-25': 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº',
            '2026-06-06': 'ÌòÑÏ∂©Ïùº',
            '2026-08-15': 'Í¥ëÎ≥µÏ†à',
            '2026-09-24': 'Ï∂îÏÑùÏó∞Ìú¥',
            '2026-09-25': 'Ï∂îÏÑù',
            '2026-09-26': 'Ï∂îÏÑùÏó∞Ìú¥',
            '2026-10-03': 'Í∞úÏ≤úÏ†à',
            '2026-10-09': 'ÌïúÍ∏ÄÎÇ†',
            '2026-12-25': 'ÌÅ¨Î¶¨Ïä§ÎßàÏä§'
        };

        // ÌÖåÎßà Î∞è Ï†úÎ™© Í¥ÄÎ†® Ìï®Ïàò
        function selectTheme(btn, theme) {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            currentTheme = theme;
            
            // Ï¶âÏãú ÌÖåÎßà Ï†ÅÏö©
            applyTheme(theme);
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('appTheme', theme);
        }

        function updateAppTitle(title) {
            document.getElementById('appTitle').textContent = title;
            localStorage.setItem('appTitle', title);
        }

        // ÏÑ§Ï†ï Í¥ÄÎ†® Ìï®Ïàò
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            
            // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÏïÑÏù¥ÏΩò ÌëúÏãú
            document.querySelectorAll('.icon-selector').forEach((selector, index) => {
                const buttons = selector.querySelectorAll('.icon-btn');
                buttons.forEach(btn => {
                    btn.classList.remove('selected');
                    const icon = btn.textContent;
                    if (index === 0 && icon === myIcon) {
                        btn.classList.add('selected');
                    } else if (index === 1 && icon === partnerIcon) {
                        btn.classList.add('selected');
                    }
                });
            });
            
            // ÌòÑÏû¨ ÌÖåÎßà ÌëúÏãú
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.onclick.toString().includes(`'${currentTheme}'`)) {
                    btn.classList.add('selected');
                }
            });
            
            // ÌòÑÏû¨ Ï†úÎ™© ÌëúÏãú
            document.getElementById('appTitleInput').value = appTitle;
            
            // Í∏∞ÎÖêÏùº Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ
            renderAnniversaryList();
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function selectMyIcon(btn, icon) {
            const selector = btn.parentElement;
            selector.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            myIcon = icon;
        }

        function selectPartnerIcon(btn, icon) {
            const selector = btn.parentElement;
            selector.querySelectorAll('.icon-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            partnerIcon = icon;
        }

        function saveSettings() {
            localStorage.setItem('myIcon', myIcon);
            localStorage.setItem('partnerIcon', partnerIcon);
            
            // ÌÖåÎßàÎäî Ïù¥ÎØ∏ Ï¶âÏãú Ï†ÅÏö©ÎêòÏóàÏúºÎØÄÎ°ú Ï†ÄÏû•Îßå
            localStorage.setItem('appTheme', currentTheme);
            
            // Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            const newTitle = document.getElementById('appTitleInput').value.trim() || 'Ïö∞Î¶¨Ïùò Í≥µÍ∞Ñ';
            appTitle = newTitle;
            updateAppTitle(newTitle);
            
            alert('‚úÖ ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
            closeSettings();
            
            // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
            renderCalendar();
            updateUpcomingAnniversary();
            
            // ÌòÑÏû¨ ÌëúÏãúÎêú ÏùºÍ∏∞ ÏÉàÎ°úÍ≥†Ïπ®
            displayDateEntries(selectedDate);
        }

        // Ï¥àÍ∏∞Ìôî
        function init() {
            // ÌÖåÎßà Ï†ÅÏö©
            applyTheme(currentTheme);
            
            // Ï†úÎ™© Ï†ÅÏö©
            updateAppTitle(appTitle);
            
            // Ïò§Îäò ÎÇ†Ïßú ÏÑ§Ï†ï
            const today = new Date().toISOString().split('T')[0];
            selectedDate = today; // Ï†ÑÏó≠ Î≥ÄÏàòÏóê ÏÑ§Ï†ï
            document.getElementById('entryDate').value = today;
            
            // Îã¨Î†• Î†åÎçîÎßÅ
            renderCalendar();
            
            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            updateStats();
            
            // Ï∂îÏñµ Í∞§Îü¨Î¶¨ ÏóÖÎç∞Ïù¥Ìä∏
            updateMemories();
            
            // Îã§Í∞ÄÏò§Îäî Í∏∞ÎÖêÏùº ÏóÖÎç∞Ïù¥Ìä∏
            updateUpcomingAnniversary();
            
            // Ïò§Îäò ÎÇ†Ïßú ÏûêÎèô ÌëúÏãú
            displayDateEntries(today);
            
            // ÏÇ¨ÏßÑ ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ ÏÑ§Ï†ï
            setupDragAndDrop();
            
            // ÏûêÎèô Ï†ÄÏû• ÏÑ§Ï†ï
            setupAutosave();
            
            // Îç∞Î™® Îç∞Ïù¥ÌÑ∞ (Ï≤òÏùå Î∞©Î¨∏Ïãú)
            if (Object.keys(entries).length === 0) {
                addDemoData();
            }
        }

        // Îç∞Î™® Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
        function addDemoData() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const todayStr = today.toISOString().split('T')[0];
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            // Ïò§Îäò ÎÇ†Ïßú ÏùºÍ∏∞
            const todayTime = new Date();
            todayTime.setHours(14, 30, 0);
            
            entries[todayStr] = {
                content: "Ïò§Îäò Ìï®Íªò ÏÇ∞Ï±ÖÌïòÎ©¥ÏÑú Ï†ïÎßê ÌñâÎ≥µÌñàÏñ¥. ÎãπÏã†Í≥º Ìï®ÍªòÌïòÎäî Î™®Îì† ÏàúÍ∞ÑÏù¥ ÏÜåÏ§ëÌï¥Ïöî üíï",
                mood: "üòç",
                photos: [],
                createdAt: todayTime.toISOString()
            };
            
            // ÌååÌä∏ÎÑà ÏùºÍ∏∞
            const partnerTime = new Date();
            partnerTime.setHours(20, 15, 0);
            
            partnerEntries[todayStr] = {
                content: "Ïò§Îäò ÌïòÎ£®ÎèÑ Ìï®Íªò ÏûàÏñ¥ÏÑú Ï†ïÎßê ÌñâÎ≥µÌñàÏñ¥! Îß§ÏùºÎß§ÏùºÏù¥ Í∏∞ÎÖêÏùº Í∞ôÏïÑ ü•∞",
                mood: "ü•∞",
                photos: [],
                createdAt: partnerTime.toISOString(),
                comments: [
                    { 
                        author: "ÎÇò", 
                        text: "ÎÇòÎèÑ Ï†ïÎßê Í∑∏Îûò! Îß§Ïùº Ìï®ÍªòÌï¥Ï§òÏÑú Í≥†ÎßàÏõå üíï",
                        createdAt: new Date().toISOString()
                    }
                ],
                liked: false
            };
            
            localStorage.setItem('diaryEntries', JSON.stringify(entries));
            localStorage.setItem('partnerEntries', JSON.stringify(partnerEntries));
            
            renderCalendar();
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats() {
            const start = new Date(startDate);
            const today = new Date();
            const diffTime = Math.abs(today - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const totalEntries = Object.keys(entries).length + Object.keys(partnerEntries).length;
            
            document.getElementById('totalDays').textContent = diffDays;
            document.getElementById('totalEntries').textContent = totalEntries;
        }

        // Îã¨Î†• Î†åÎçîÎßÅ
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Ïõî ÌëúÏãú
            document.getElementById('currentMonth').textContent = 
                `${year}ÎÖÑ ${month + 1}Ïõî`;
            
            // Ï≤´ ÎÇ†Í≥º ÎßàÏßÄÎßâ ÎÇ†
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            let html = '';
            
            // Ïù¥Ï†Ñ Îã¨ Îπà Ïπ∏
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div class="day other-month"></div>';
            }
            
            // ÌòÑÏû¨ Îã¨ ÎÇ†Ïßú
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = dateStr === todayStr;
                const isSelected = dateStr === selectedDate;
                const hasMyEntry = entries[dateStr];
                const hasPartnerEntry = partnerEntries[dateStr];
                const hasBoth = hasMyEntry && hasPartnerEntry;
                const isHoliday = holidays[dateStr];
                const anniversary = anniversaries.find(a => a.date === dateStr);
                const isAnniversary = !!anniversary;
                
                let classes = 'day';
                if (isToday) classes += ' today';
                if (isSelected) classes += ' selected';
                if (hasBoth) classes += ' has-both';
                else if (hasMyEntry || hasPartnerEntry) classes += ' has-entry';
                if (isHoliday) classes += ' holiday';
                if (isAnniversary) classes += ' anniversary-day';
                
                const holidayAttr = isHoliday ? `data-holiday="${isHoliday}"` : '';
                
                // ÏïÑÏù¥ÏΩò ÌëúÏãú
                let iconsHtml = '';
                if (hasBoth) {
                    iconsHtml = `<div class="day-icons">${myIcon}${partnerIcon}</div>`;
                } else if (hasMyEntry) {
                    iconsHtml = `<div class="day-icons">${myIcon}</div>`;
                } else if (hasPartnerEntry) {
                    iconsHtml = `<div class="day-icons">${partnerIcon}</div>`;
                }
                
                // Í∏∞ÎÖêÏùº ÏïÑÏù¥ÏΩò
                let anniversaryIconHtml = '';
                if (isAnniversary) {
                    const icon = anniversary.icon || 'üéâ';
                    anniversaryIconHtml = `<span class="anniversary-icon">${icon}</span>`;
                }
                
                html += `<button class="${classes}" ${holidayAttr} onclick="selectDate('${dateStr}')">
                    ${anniversaryIconHtml}
                    <span class="day-number">${day}</span>${iconsHtml}
                </button>`;
            }
            
            // Îã§Ïùå Îã¨ Îπà Ïπ∏
            const totalCells = Math.ceil((startingDayOfWeek + daysInMonth) / 7) * 7;
            for (let i = daysInMonth + startingDayOfWeek; i < totalCells; i++) {
                html += '<div class="day other-month"></div>';
            }
            
            document.getElementById('calendarDays').innerHTML = html;
        }

        function prevMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function selectDate(dateStr) {
            selectedDate = dateStr;
            renderCalendar();
            displayDateEntries(dateStr);
        }

        // Í∏∞ÎÖêÏùº Í¥ÄÎ†® Ìï®Ïàò
        function selectAnniversaryIcon(btn, icon) {
            document.querySelectorAll('.anniversary-icon-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedAnniversaryIcon = icon;
            document.getElementById('selectedAnniversaryIcon').textContent = icon;
        }

        function renderAnniversaryList() {
            const container = document.getElementById('anniversaryList');
            const addBtn = document.getElementById('addAnniversaryBtn');
            
            if (anniversaries.length === 0) {
                container.innerHTML = '<div class="anniversary-empty">ÏïÑÏßÅ Îì±Î°ùÎêú Í∏∞ÎÖêÏùºÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                addBtn.disabled = false;
                return;
            }
            
            // ÎÇ†ÏßúÏàú Ï†ïÎ†¨
            anniversaries.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let html = '';
            anniversaries.forEach((anni, index) => {
                const dday = calculateDday(anni.date);
                const icon = anni.icon || 'üéâ';
                html += `
                    <div class="anniversary-item">
                        <div class="anniversary-info">
                            <div class="anniversary-icon-display">${icon}</div>
                            <div class="anniversary-text">
                                <div class="anniversary-name">${anni.name}</div>
                                <div class="anniversary-date">${anni.date}</div>
                                <div class="anniversary-dday">${dday}</div>
                            </div>
                        </div>
                        <button class="anniversary-delete" onclick="deleteAnniversary(${index})">√ó</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            addBtn.disabled = anniversaries.length >= 5;
        }

        function calculateDday(dateStr) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const target = new Date(dateStr);
            target.setHours(0, 0, 0, 0);
            
            const diff = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
            
            if (diff === 0) return 'Ïò§ÎäòÏù¥ Î∞îÎ°ú Í∑∏ÎÇ†! üéâ';
            if (diff > 0) return `D-${diff}`;
            
            const daysPassed = Math.abs(diff);
            return `${daysPassed}ÏùºÏß∏`;
        }

        function showAddAnniversaryForm() {
            document.getElementById('anniversaryForm').style.display = 'block';
            document.getElementById('addAnniversaryBtn').style.display = 'none';
            document.getElementById('anniversaryName').focus();
        }

        function cancelAnniversaryForm() {
            document.getElementById('anniversaryForm').style.display = 'none';
            document.getElementById('addAnniversaryBtn').style.display = 'block';
            document.getElementById('anniversaryName').value = '';
            document.getElementById('anniversaryDate').value = '';
            selectedAnniversaryIcon = 'üéâ';
            document.getElementById('selectedAnniversaryIcon').textContent = 'üéâ';
            document.querySelectorAll('.anniversary-icon-btn').forEach(b => b.classList.remove('selected'));
        }

        function saveAnniversary() {
            const name = document.getElementById('anniversaryName').value.trim();
            const date = document.getElementById('anniversaryDate').value;
            
            if (!name) {
                alert('Í∏∞ÎÖêÏùº Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (!date) {
                alert('ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            anniversaries.push({ 
                name, 
                date, 
                icon: selectedAnniversaryIcon 
            });
            localStorage.setItem('anniversaries', JSON.stringify(anniversaries));
            
            renderAnniversaryList();
            cancelAnniversaryForm();
            updateUpcomingAnniversary();
            renderCalendar();
        }

        function deleteAnniversary(index) {
            showConfirmModal(
                'Í∏∞ÎÖêÏùºÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                `"${anniversaries[index].name}"ÏùÑ(Î•º) ÏÇ≠Ï†úÌï©ÎãàÎã§.`,
                () => {
                    anniversaries.splice(index, 1);
                    localStorage.setItem('anniversaries', JSON.stringify(anniversaries));
                    renderAnniversaryList();
                    renderCalendar();
                    updateUpcomingAnniversary();
                },
                'üéâ'
            );
        }

        function updateUpcomingAnniversary() {
            const container = document.getElementById('upcomingAnniversary');
            
            if (anniversaries.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Ïò§Îäò ÎòêÎäî Í∞ÄÏû• Í∞ÄÍπåÏö¥ ÎØ∏Îûò Í∏∞ÎÖêÏùº Ï∞æÍ∏∞
            let nearest = null;
            let minDiff = Infinity;
            
            anniversaries.forEach(anni => {
                const target = new Date(anni.date);
                target.setHours(0, 0, 0, 0);
                const diff = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
                
                if (diff >= 0 && diff < minDiff) {
                    minDiff = diff;
                    nearest = { ...anni, diff };
                }
            });
            
            if (!nearest || nearest.diff > 30) {
                container.innerHTML = '';
                return;
            }
            
            const dday = calculateDday(nearest.date);
            const icon = nearest.icon || 'üéâ';
            let message = '';
            
            if (nearest.diff === 0) {
                message = `Ïò§ÎäòÏùÄ <strong>${nearest.name}</strong>ÏûÖÎãàÎã§! ${icon}`;
            } else if (nearest.diff <= 7) {
                message = `<strong>${nearest.name}</strong>Ïù¥(Í∞Ä) ${nearest.diff}Ïùº ÎÇ®ÏïòÏñ¥Ïöî! ${dday}`;
            } else {
                message = `Îã§Í∞ÄÏò§Îäî Í∏∞ÎÖêÏùº: <strong>${nearest.name}</strong> ${dday}`;
            }
            
            container.innerHTML = `
                <div class="anniversary-alert">
                    <div class="anniversary-alert-title">
                        <span>${icon}</span>
                        <span>Îã§Í∞ÄÏò§Îäî Í∏∞ÎÖêÏùº</span>
                    </div>
                    <div class="anniversary-alert-content">${message}</div>
                </div>
            `;
        }

        // ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÏùò ÏùºÍ∏∞ ÌëúÏãú
        function displayDateEntries(dateStr) {
            const myEntry = entries[dateStr];
            const partnerEntry = partnerEntries[dateStr];
            const anniversary = anniversaries.find(a => a.date === dateStr);
            let html = '';
            
            // Í∏∞ÎÖêÏùº Î∞∞ÏßÄ
            if (anniversary) {
                const icon = anniversary.icon || 'üéâ';
                html += `
                    <div class="anniversary-alert">
                        <div class="anniversary-alert-title">
                            <span>${icon}</span>
                            <span>${anniversary.name}</span>
                        </div>
                        <div class="anniversary-alert-content">
                            ${calculateDday(anniversary.date)}
                        </div>
                    </div>
                `;
            }
            
            // ÎÇ¥ ÏùºÍ∏∞
            if (myEntry) {
                html += renderDiaryCard(dateStr, myEntry, 'my');
            }
            
            // ÌååÌä∏ÎÑà ÏùºÍ∏∞
            if (partnerEntry) {
                html += renderDiaryCard(dateStr, partnerEntry, 'partner');
            }
            
            if (!myEntry && !partnerEntry) {
                html += `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>Ïù¥ ÎÇ†ÏßúÏóê Í∏∞Î°ùÌïú ÏùºÍ∏∞Í∞Ä ÏóÜÏäµÎãàÎã§.<br>ÏÉàÎ°úÏö¥ ÏùºÍ∏∞Î•º ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!</p>
                        <button class="empty-state-btn" onclick="goToWriteWithDate('${dateStr}')">
                            ‚úçÔ∏è ÏùºÍ∏∞ ÏûëÏÑ±ÌïòÍ∏∞
                        </button>
                    </div>
                `;
            }
            
            document.getElementById('selectedDayEntries').innerHTML = html;
            
            // ÎåìÍ∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            setupCommentEventListeners();
        }

        // ÏùºÍ∏∞ Ïπ¥Îìú Î†åÎçîÎßÅ
        function renderDiaryCard(dateStr, entry, type) {
            const isMyEntry = type === 'my';
            const cardClass = isMyEntry ? '' : 'partner';
            const writerClass = isMyEntry ? '' : 'partner-writer';
            const writerIcon = isMyEntry ? myIcon : partnerIcon;
            const writerName = isMyEntry ? 'ÎÇò' : 'ÌååÌä∏ÎÑà';
            
            let html = `
                <div class="diary-card ${cardClass}">
                    <div class="diary-card-header">
                        <div>
                            <div class="diary-writer ${writerClass}">
                                <span class="diary-writer-icon">
                                    <span class="user-icon">${writerIcon}</span>
                                    <span>${writerName}</span>
                                </span>
                            </div>
                            <div class="diary-date">${dateStr}</div>
                        </div>
                        <div class="diary-mood">${entry.mood || 'üòä'}</div>
                    </div>
                    <div class="diary-content">${entry.content}</div>
            `;
            
            // ÏÇ¨ÏßÑ
            if (entry.photos && entry.photos.length > 0) {
                html += '<div class="diary-images">';
                entry.photos.forEach(photo => {
                    html += `<img src="${photo}" class="diary-image" alt="ÏÇ¨ÏßÑ" onclick="openModal('${photo}')">`;
                });
                html += '</div>';
            }

            // Î©îÌÉÄ Ï†ïÎ≥¥ (Í∏ÄÏûê Ïàò, ÏÇ¨ÏßÑ Ïàò)
            const charCount = entry.content.length;
            const photoCount = entry.photos ? entry.photos.length : 0;
            html += `
                <div class="diary-meta">
                    <span class="diary-meta-item">üìù ${charCount}Ïûê</span>
                    ${photoCount > 0 ? `<span class="diary-meta-item">üì∑ ${photoCount}Ïû•</span>` : ''}
                    <span class="diary-meta-item">‚è∞ ${new Date(entry.createdAt).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</span>
                </div>
            `;
            
            // Ïï°ÏÖò Î≤ÑÌäº
            if (isMyEntry) {
                html += `
                    <div class="diary-actions">
                        <button class="action-btn" onclick="editEntry('${dateStr}')">‚úèÔ∏è ÏàòÏ†ï</button>
                        <button class="action-btn" onclick="deleteEntry('${dateStr}')">üóëÔ∏è ÏÇ≠Ï†ú</button>
                    </div>
                `;
            } else {
                const likedClass = entry.liked ? 'liked' : '';
                const commentCount = entry.comments ? entry.comments.length : 0;
                html += `
                    <div class="diary-actions">
                        <button class="action-btn ${likedClass}" onclick="toggleLike('${dateStr}')">
                            ${entry.liked ? '‚ù§Ô∏è' : 'ü§ç'} Ï¢ãÏïÑÏöî
                        </button>
                        <button class="action-btn" onclick="toggleCommentInput('${dateStr}')">üí¨ ÎåìÍ∏Ä ${commentCount > 0 ? `(${commentCount})` : ''}</button>
                    </div>
                `;
                
                // ÎåìÍ∏Ä ÏÑπÏÖò
                html += `<div class="comments-section" id="comments-${dateStr}">`;
                if (entry.comments && entry.comments.length > 0) {
                    entry.comments.forEach((comment, index) => {
                        html += `
                            <div class="comment" id="comment-${dateStr}-${index}">
                                <div class="comment-header">
                                    <div class="comment-author">${myIcon} ${comment.author}</div>
                                    <div class="comment-actions">
                                        <button class="comment-action-btn" data-action="edit" data-date="${dateStr}" data-index="${index}">ÏàòÏ†ï</button>
                                        <button class="comment-action-btn" data-action="delete" data-date="${dateStr}" data-index="${index}">ÏÇ≠Ï†ú</button>
                                    </div>
                                </div>
                                <div class="comment-text">${comment.text}</div>
                            </div>
                        `;
                    });
                }
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }

        // ÎåìÍ∏Ä Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupCommentEventListeners() {
            document.querySelectorAll('.comment-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.dataset.action;
                    const dateStr = this.dataset.date;
                    const index = parseInt(this.dataset.index);
                    
                    if (action === 'edit') {
                        editComment(dateStr, index);
                    } else if (action === 'delete') {
                        deleteComment(dateStr, index);
                    }
                });
            });
        }

        // Í∏∞Î∂Ñ ÏÑ†ÌÉù
        function selectMood(btn, mood) {
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedMoodValue = mood;
        }

        // Í∏ÄÏûê Ïàò Ïπ¥Ïö¥Ìä∏
        function updateCharCount() {
            const content = document.getElementById('diaryContent').value;
            document.getElementById('charCount').textContent = content.length;
        }

        // ÏûêÎèô Ï†ÄÏû• ÏÑ§Ï†ï
        function setupAutosave() {
            const textarea = document.getElementById('diaryContent');
            textarea.addEventListener('input', () => {
                clearTimeout(autosaveTimer);
                autosaveTimer = setTimeout(() => {
                    const dateStr = document.getElementById('entryDate').value;
                    const content = textarea.value.trim();
                    if (content) {
                        const draft = {
                            content,
                            mood: selectedMoodValue || 'üòä',
                            photos: uploadedPhotos,
                            isDraft: true
                        };
                        localStorage.setItem(`draft-${dateStr}`, JSON.stringify(draft));
                        showAutosaveIndicator();
                    }
                }, 2000);
            });
        }

        function showAutosaveIndicator() {
            const indicator = document.getElementById('autosaveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // ÏùºÍ∏∞ Ï†ÄÏû•
        function saveDiary() {
            const dateStr = document.getElementById('entryDate').value;
            const content = document.getElementById('diaryContent').value.trim();
            
            if (!content) {
                alert('ÏùºÍ∏∞Î•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (!selectedMoodValue) {
                alert('Ïò§ÎäòÏùò Í∏∞Î∂ÑÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            const entry = {
                content,
                mood: selectedMoodValue,
                photos: uploadedPhotos,
                createdAt: new Date().toISOString()
            };
            
            entries[dateStr] = entry;
            localStorage.setItem('diaryEntries', JSON.stringify(entries));
            localStorage.removeItem(`draft-${dateStr}`);
            
            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            alert('üíï ÏùºÍ∏∞Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
            
            // Ìèº Ï¥àÍ∏∞Ìôî
            resetForm();
            
            // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
            selectedDate = dateStr; // Ï†ÄÏû•Ìïú ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÎ°ú ÏÑ§Ï†ï
            renderCalendar();
            updateStats();
            updateMemories();
            switchTab('calendar', document.querySelector('.tab-btn'));
            displayDateEntries(dateStr);
        }

        function resetForm() {
            document.getElementById('diaryContent').value = '';
            document.getElementById('photoPreview').innerHTML = '';
            document.getElementById('photoInput').value = '';
            document.getElementById('charCount').textContent = '0';
            uploadedPhotos = [];
            selectedMoodValue = '';
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
        }

        // ÏùºÍ∏∞ ÏàòÏ†ï
        function editEntry(dateStr) {
            const entry = entries[dateStr];
            switchTab('write', document.querySelectorAll('.tab-btn')[1]);
            
            document.getElementById('entryDate').value = dateStr;
            document.getElementById('diaryContent').value = entry.content;
            updateCharCount();
            
            // Í∏∞Î∂Ñ ÏÑ§Ï†ï
            document.querySelectorAll('.mood-btn').forEach(btn => {
                if (btn.textContent === entry.mood) {
                    selectMood(btn, entry.mood);
                }
            });
            
            // ÏÇ¨ÏßÑ ÏÑ§Ï†ï
            uploadedPhotos = entry.photos || [];
            displayPhotoPreviews();
        }

        // ÏùºÍ∏∞ ÏÇ≠Ï†ú
        function deleteEntry(dateStr) {
            showConfirmModal(
                'ÏùºÍ∏∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                'ÏÇ≠Ï†úÎêú ÏùºÍ∏∞Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.',
                () => {
                    delete entries[dateStr];
                    localStorage.setItem('diaryEntries', JSON.stringify(entries));
                    renderCalendar();
                    updateStats();
                    updateMemories();
                    displayDateEntries(dateStr);
                },
                'üóëÔ∏è'
            );
        }

        // Ï¢ãÏïÑÏöî ÌÜ†Í∏Ä
        function toggleLike(dateStr) {
            if (partnerEntries[dateStr]) {
                partnerEntries[dateStr].liked = !partnerEntries[dateStr].liked;
                localStorage.setItem('partnerEntries', JSON.stringify(partnerEntries));
                displayDateEntries(dateStr);
            }
        }

        // ÎåìÍ∏Ä ÏûÖÎ†•Ï∞Ω ÌÜ†Í∏Ä
        function toggleCommentInput(dateStr) {
            const commentsSection = document.getElementById(`comments-${dateStr}`);
            const existingInput = commentsSection.querySelector('.comment-input-group');
            
            if (existingInput) {
                existingInput.remove();
            } else {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'comment-input-group';
                inputGroup.innerHTML = `
                    <input type="text" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." id="comment-input-${dateStr}">
                    <button onclick="addComment('${dateStr}')">Îì±Î°ù</button>
                `;
                commentsSection.appendChild(inputGroup);
                document.getElementById(`comment-input-${dateStr}`).focus();
            }
        }

        // ÎåìÍ∏Ä Ï∂îÍ∞Ä
        function addComment(dateStr) {
            const input = document.getElementById(`comment-input-${dateStr}`);
            const text = input.value.trim();
            
            if (text) {
                if (!partnerEntries[dateStr].comments) {
                    partnerEntries[dateStr].comments = [];
                }
                
                partnerEntries[dateStr].comments.push({
                    author: 'ÎÇò',
                    text: text
                });
                
                localStorage.setItem('partnerEntries', JSON.stringify(partnerEntries));
                displayDateEntries(dateStr);
            }
        }

        // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú Ï≤òÎ¶¨
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files).slice(0, 3);
            uploadedPhotos = [];
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedPhotos.push(event.target.result);
                    displayPhotoPreviews();
                };
                reader.readAsDataURL(file);
            });
        });

        function displayPhotoPreviews() {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            
            uploadedPhotos.forEach((photo, index) => {
                const item = document.createElement('div');
                item.className = 'preview-item';
                item.innerHTML = `
                    <img src="${photo}" alt="ÎØ∏Î¶¨Î≥¥Í∏∞">
                    <button class="preview-remove" onclick="removePhoto(${index})">√ó</button>
                `;
                preview.appendChild(item);
            });
        }

        function removePhoto(index) {
            uploadedPhotos.splice(index, 1);
            displayPhotoPreviews();
        }

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ ÏÑ§Ï†ï
        function setupDragAndDrop() {
            const uploadArea = document.querySelector('.photo-upload-area');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.add('drag-over');
                });
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => {
                    uploadArea.classList.remove('drag-over');
                });
            });
            
            uploadArea.addEventListener('drop', handleDrop);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = Array.from(dt.files).slice(0, 3);
                
                uploadedPhotos = [];
                files.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            uploadedPhotos.push(event.target.result);
                            displayPhotoPreviews();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // Ï∂îÏñµ Í∞§Îü¨Î¶¨ ÏóÖÎç∞Ïù¥Ìä∏
        function updateMemories() {
            const allPhotos = [
                ...Object.values(entries),
                ...Object.values(partnerEntries)
            ]
            .filter(e => e.photos && e.photos.length > 0)
            .flatMap(e => e.photos);
            
            document.getElementById('galleryCount').textContent = `${allPhotos.length}Í∞úÏùò ÏÇ¨ÏßÑ`;
            
            const grid = document.getElementById('memoriesGrid');
            
            if (allPhotos.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">üéûÔ∏è</div>
                        <p>ÏïÑÏßÅ ÏÇ¨ÏßÑÏù¥ ÏóÜÏäµÎãàÎã§.<br>ÏùºÍ∏∞Ïóê ÏÇ¨ÏßÑÏùÑ Ï≤®Î∂ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>
                        <button class="empty-state-btn" onclick="goToWrite()">
                            ‚úçÔ∏è ÏùºÍ∏∞ ÏûëÏÑ±ÌïòÍ∏∞
                        </button>
                    </div>
                `;
            } else {
                grid.innerHTML = allPhotos.map(photo => 
                    `<div class="memory-item" onclick="openModal('${photo}')">
                        <img src="${photo}" alt="Ï∂îÏñµ">
                    </div>`
                ).join('');
            }
        }

        // Ïù¥ÎØ∏ÏßÄ Î™®Îã¨
        function openModal(photoSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.classList.add('active');
            modalImg.src = photoSrc;
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('active');
        }

        // ÎåìÍ∏Ä Ï∂îÍ∞Ä
        function addComment(dateStr) {
            const input = document.getElementById(`comment-input-${dateStr}`);
            const text = input.value.trim();
            
            if (text) {
                if (!partnerEntries[dateStr].comments) {
                    partnerEntries[dateStr].comments = [];
                }
                
                partnerEntries[dateStr].comments.push({
                    author: 'ÎÇò',
                    text: text,
                    createdAt: new Date().toISOString()
                });
                
                localStorage.setItem('partnerEntries', JSON.stringify(partnerEntries));
                displayDateEntries(dateStr);
            }
        }

        // ÎåìÍ∏Ä ÏàòÏ†ï
        function editComment(dateStr, commentIndex) {
            const comment = partnerEntries[dateStr].comments[commentIndex];
            const commentElement = document.getElementById(`comment-${dateStr}-${commentIndex}`);
            
            commentElement.innerHTML = `
                <div class="comment-header">
                    <div class="comment-author">${myIcon} ${comment.author}</div>
                </div>
                <input type="text" class="comment-edit-input" id="edit-input-${dateStr}-${commentIndex}" value="${comment.text}">
                <div class="comment-edit-actions">
                    <button class="comment-save-btn" onclick="saveCommentEdit('${dateStr}', ${commentIndex})">Ï†ÄÏû•</button>
                    <button class="comment-cancel-btn" onclick="cancelCommentEdit('${dateStr}')">Ï∑®ÏÜå</button>
                </div>
            `;
            
            document.getElementById(`edit-input-${dateStr}-${commentIndex}`).focus();
        }

        // ÎåìÍ∏Ä ÏàòÏ†ï Ï†ÄÏû•
        function saveCommentEdit(dateStr, commentIndex) {
            const input = document.getElementById(`edit-input-${dateStr}-${commentIndex}`);
            const newText = input.value.trim();
            
            if (newText) {
                partnerEntries[dateStr].comments[commentIndex].text = newText;
                partnerEntries[dateStr].comments[commentIndex].editedAt = new Date().toISOString();
                localStorage.setItem('partnerEntries', JSON.stringify(partnerEntries));
                displayDateEntries(dateStr);
            }
        }

        // ÎåìÍ∏Ä ÏàòÏ†ï Ï∑®ÏÜå
        function cancelCommentEdit(dateStr) {
            displayDateEntries(dateStr);
        }

        // ÎåìÍ∏Ä ÏÇ≠Ï†ú
        function deleteComment(dateStr, commentIndex) {
            showConfirmModal(
                'ÎåìÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                'ÏÇ≠Ï†úÎêú ÎåìÍ∏ÄÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.',
                () => {
                    if (partnerEntries[dateStr] && partnerEntries[dateStr].comments) {
                        partnerEntries[dateStr].comments.splice(commentIndex, 1);
                        localStorage.setItem('partnerEntries', JSON.stringify(partnerEntries));
                        displayDateEntries(dateStr);
                    }
                },
                'üí¨'
            );
        }

        // Í≤ÄÏÉâ Í∏∞Îä•
        function searchDiaries() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const resultsContainer = document.getElementById('searchResults');
            
            if (!query) {
                resultsContainer.innerHTML = '';
                return;
            }
            
            const allEntries = [
                ...Object.entries(entries).map(([date, entry]) => ({date, entry, type: 'my'})),
                ...Object.entries(partnerEntries).map(([date, entry]) => ({date, entry, type: 'partner'}))
            ];
            
            const results = allEntries.filter(({entry}) => 
                entry.content.toLowerCase().includes(query)
            ).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 12px;">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            const html = results.map(({date, entry, type}) => {
                const icon = type === 'my' ? myIcon : partnerIcon;
                const preview = entry.content.substring(0, 60) + (entry.content.length > 60 ? '...' : '');
                return `
                    <div class="search-result-item" onclick="goToSearchResult('${date}')">
                        <div class="search-result-date">${icon} ${date}</div>
                        <div class="search-result-preview">${preview}</div>
                    </div>
                `;
            }).join('');
            
            resultsContainer.innerHTML = html;
        }

        // Í≤ÄÏÉâ Í≤∞Í≥ºÎ°ú Ïù¥Îèô
        function goToSearchResult(dateStr) {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
            
            // Ìï¥Îãπ ÎÇ†ÏßúÎ°ú Îã¨Î†• Ïù¥Îèô
            const [year, month] = dateStr.split('-').map(Number);
            currentDate = new Date(year, month - 1, 1);
            renderCalendar();
            
            // Ìï¥Îãπ ÎÇ†Ïßú ÏÑ†ÌÉù
            setTimeout(() => {
                selectDate(dateStr);
                document.getElementById('selectedDayEntries').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // ÏùºÍ∏∞ ÏûëÏÑ± ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        function goToWrite() {
            switchTab('write', document.querySelectorAll('.tab-btn')[1]);
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('entryDate').value = today;
        }

        function goToWriteWithDate(dateStr) {
            switchTab('write', document.querySelectorAll('.tab-btn')[1]);
            document.getElementById('entryDate').value = dateStr;
        }

        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(tabName, btnElement) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            if (btnElement) {
                btnElement.classList.add('active');
            }
            
            if (tabName === 'memories') {
                updateMemories();
            }
        }

        // Ï¥àÍ∏∞Ìôî
        init();
    </script>
</body>
</html>